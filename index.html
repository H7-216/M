<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Bit - Streaming Avancé</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #fff;
            line-height: 1.6;
            min-height: 100vh;
        }

        header {
            background: rgba(0,0,0,0.8);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: #00d4ff;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .search-bar {
            display: flex;
            gap: 0.5rem;
            flex: 1;
            max-width: 400px;
        }

        .search-input {
            flex: 1;
            padding: 0.75rem;
            border: none;
            border-radius: 25px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-size: 1rem;
            outline: none;
            backdrop-filter: blur(5px);
        }

        .search-input::placeholder {
            color: rgba(255,255,255,0.6);
        }

        .search-btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.4);
        }

        .nav-tabs {
            display: flex;
            gap: 1rem;
            margin: 2rem 0;
            overflow-x: auto;
            padding: 0 1rem;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 25px;
            color: #fff;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .tab:hover, .tab.active {
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            transform: translateY(-2px);
        }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 1.5rem;
            padding: 2rem 0;
        }

        .short {
            position: relative;
        }

        .short-in {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            background: rgba(255,255,255,0.05);
            transition: all 0.3s ease;
            height: auto;
        }

        .short-in:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.3);
        }

        .film-version {
            position: absolute;
            top: 5px;
            left: 5px;
            z-index: 10;
            background: rgba(0, 212, 255, 0.9);
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .film-version a {
            color: white;
            text-decoration: none;
        }

        .short-poster {
            position: relative;
            display: block;
            width: 100%;
            height: 240px;
            overflow: hidden;
            border-radius: 8px 8px 0 0;
        }

        .short-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .short-in:hover .short-poster img {
            transform: scale(1.1);
        }

        .vote-circle {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 35px;
            height: 35px;
            background: rgba(0,0,0,0.8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            color: #00d4ff;
            border: 2px solid rgba(0, 212, 255, 0.5);
        }

        .short-mask {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            border-radius: 8px 8px 0 0;
        }

        .short-in:hover .short-mask {
            opacity: 1;
        }

        .fa-play-circle3 {
            font-size: 3rem;
            color: #00d4ff;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.8);
        }

        .fa-play-circle3::before {
            content: "▶";
        }

        .mli-eps {
            position: absolute;
            bottom: 35px;
            right: 5px;
            background: rgba(255, 165, 0, 0.9);
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .short-title {
            padding: 0.75rem;
            font-size: 0.9rem;
            font-weight: bold;
            color: #fff;
            text-align: center;
            background: rgba(0,0,0,0.3);
            border-radius: 0 0 8px 8px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            padding: 2rem;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #1a1a2e;
            border-radius: 15px;
            width: 95%;
            max-width: 1200px;
            height: 90%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 2px solid rgba(0, 212, 255, 0.3);
        }

        .modal-header {
            padding: 1rem;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .modal-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .quality-selector {
            padding: 0.5rem;
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .subtitle-selector {
            padding: 0.5rem;
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .close-btn {
            background: #ff4444;
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 1rem;
            z-index: 10;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(0, 212, 255, 0.3);
            border-radius: 50%;
            border-top-color: #00d4ff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .modal-iframe {
            flex: 1;
            border: none;
            width: 100%;
            position: relative;
        }

        .video-player {
            width: 100%;
            height: 100%;
            background: #000;
        }

        .status-indicator {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 0.25rem 0.5rem;
            background: rgba(0, 212, 255, 0.9);
            color: white;
            border-radius: 3px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .footer {
            background: rgba(0,0,0,0.8);
            padding: 2rem 0;
            text-align: center;
            margin-top: 4rem;
        }

        .footer p {
            color: rgba(255,255,255,0.6);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
            }
            
            .search-bar {
                width: 100%;
                max-width: none;
            }
            
            .content-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 1rem;
            }
            
            .nav-tabs {
                padding: 0;
            }

            .short-poster {
                height: 200px;
            }

            .modal-controls {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">🎬 Le Bit Pro</div>
                <div class="search-bar">
                    <input type="text" class="search-input" placeholder="Rechercher un film, une série..." id="searchInput">
                    <button class="search-btn" onclick="searchContent()">🔍</button>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="nav-tabs">
            <button class="tab active" onclick="switchTab('films')">Films</button>
            <button class="tab" onclick="switchTab('series')">Séries</button>
            <button class="tab" onclick="switchTab('anime')">Animés</button>
            <button class="tab" onclick="switchTab('documentaires')">Documentaires</button>
        </div>

        <div class="content-grid" id="contentGrid">
            <!-- Le contenu sera généré par JavaScript -->
        </div>
    </div>

    <div class="modal" id="playerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Lecture en cours</h3>
                <div class="modal-controls">
                    <select class="quality-selector" id="qualitySelector">
                        <option value="">Qualité</option>
                    </select>
                    <select class="subtitle-selector" id="subtitleSelector">
                        <option value="">Sous-titres</option>
                    </select>
                    <button class="close-btn" onclick="closePlayer()">✖ Fermer</button>
                </div>
            </div>
            <div class="modal-iframe" id="playerContainer">
                <div class="loading-overlay" id="loadingOverlay">
                    <div class="loading-spinner"></div>
                    <p>Analyse de la vidéo en cours...</p>
                </div>
                <video class="video-player" id="videoPlayer" controls style="display: none;">
                    Votre navigateur ne supporte pas la lecture vidéo.
                </video>
                <div class="status-indicator" id="statusIndicator" style="display: none;">
                    Prêt
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>Le Bit Pro - Streaming avancé avec analyse d'URL • Accès libre et gratuit</p>
        </div>
    </footer>

    <script>
        // Simulation de l'API Python pour l'analyse des URLs
        class VideoParser {
            static async parseUrl(url, realData = null) {
                // Simulation de l'analyse selon le type d'URL
                const isBilibili = url.includes('bili') || url.split('.m4s').length === 3;
                const isIqiyi = url.includes('iqiyi.com') || url.includes('iq.com');
                const isHls = url.includes('.m3u8');
                
                // Simulation du traitement avec délai
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                let result = {
                    videoType: '',
                    headers: this.getHeaders(url),
                    audioUrls: [],
                    videoUrls: [],
                    subtitles: []
                };

                if (isHls) {
                    result.videoType = 'hls';
                    result.videoUrls = [url];
                } else if (isBilibili) {
                    result.videoType = 'dash';
                    result.audioUrls = ['https://example.com/audio.m4s'];
                    result.videoUrls = ['https://example.com/video_720p.m4s', 'https://example.com/video_1080p.m4s'];
                } else if (isIqiyi) {
                    result.videoType = 'dash';
                    result.audioUrls = ['https://example.com/iqiyi_audio.m4s'];
                    result.videoUrls = ['https://example.com/iqiyi_720p.m4s', 'https://example.com/iqiyi_1080p.m4s'];
                    result.subtitles = [
                        ['Français', 'https://example.com/subtitles_fr.srt'],
                        ['English', 'https://example.com/subtitles_en.srt']
                    ];
                } else {
                    result.videoType = 'partial';
                    result.videoUrls = [url];
                }

                return result;
            }

            static getHeaders(url) {
                const headers = {};
                
                if (url.includes('bili')) {
                    headers['referer'] = 'https://www.bilibili.com/';
                } else if (url.includes('iqiyi.com')) {
                    headers['referer'] = 'https://www.iqiyi.com/';
                } else if (url.includes('mgtv.com')) {
                    headers['referer'] = 'https://www.mgtv.com/';
                }
                
                return headers;
            }
        }

        // Base de données étendue avec des URLs d'exemple pour les différentes plateformes
        const mediaData = {
            films: [
                {
                    title: "Conclave",
                    year: "2024",
                    genre: "Drame",
                    description: "Thriller politique au Vatican",
                    url: "https://example-bili.com/video/BV1234567890.m3u8",
                    id: "15119065",
                    poster: "https://image.tmdb.org/t/p/w500/pEjycIllA02mBzX2cAl4n8IhFdq.jpg",
                    rating: "7.2",
                    version: "VF",
                    platform: "bilibili"
                },
                {
                    title: "Heretic",
                    year: "2024",
                    genre: "Horreur",
                    description: "Thriller psychologique terrifiant",
                    url: "https://cache.iqiyi.com/jp/tmts/20241201/heretic.m3u8",
                    id: "15119090",
                    poster: "https://image.tmdb.org/t/p/w500/8yBX5nlDLGUlUuZsBKX8UxOmGmG.jpg",
                    rating: "6.8",
                    version: "VOSTFR",
                    platform: "iqiyi"
                },
                {
                    title: "Kraven the Hunter",
                    year: "2024",
                    genre: "Action",
                    description: "L'origine du chasseur Spider-Man",
                    url: "https://bili-stream.com/audio.m4s|https://bili-stream.com/video.m4s",
                    id: "15119394",
                    poster: "https://image.tmdb.org/t/p/w500/1GvBhYWiz6eBaApWXbHjgJWp8gx.jpg",
                    rating: "5.9",
                    version: "VF",
                    platform: "bilibili"
                },
                {
                    title: "The Substance",
                    year: "2024",
                    genre: "Horreur",
                    description: "Horreur corporelle de Coralie Fargeat",
                    url: "https://stream.example.com/the-substance.m3u8",
                    id: "15118576",
                    poster: "https://image.tmdb.org/t/p/w500/lqoMzCcZYEFK729d6qzt349fB4o.jpg",
                    rating: "7.9",
                    version: "VOSTFR",
                    platform: "generic"
                }
            ],
            series: [
                {
                    title: "Breaking Bad",
                    year: "2008",
                    genre: "Crime",
                    description: "Série culte sur un prof devenu dealer",
                    url: "https://bili-series.com/breaking-bad-s01e01.m3u8",
                    id: "breaking-bad",
                    poster: "https://image.tmdb.org/t/p/w500/3xnWaLQjelJDDF7LT1WBo6f4BRe.jpg",
                    rating: "9.5",
                    version: "VOSTFR",
                    episodes: "62",
                    platform: "bilibili"
                }
            ],
            anime: [
                {
                    title: "Attack on Titan",
                    year: "2013",
                    genre: "Action",
                    description: "Humanité vs Titans géants",
                    url: "https://iqiyi.com/anime/attack-on-titan-episode1",
                    id: "attack-on-titan",
                    poster: "https://image.tmdb.org/t/p/w500/hTP1DtLGFamjfu8WqjnuQdP1n4i.jpg",
                    rating: "9.0",
                    version: "VOSTFR",
                    episodes: "87",
                    platform: "iqiyi"
                }
            ],
            documentaires: [
                {
                    title: "Notre Planète",
                    year: "2019",
                    genre: "Nature",
                    description: "Documentaire nature époustouflant",
                    url: "https://streaming.example.com/notre-planete.m3u8",
                    id: "notre-planete",
                    poster: "https://image.tmdb.org/t/p/w500/eFKTv0iMXU3avfb6G7C6q7DCOXB.jpg",
                    rating: "9.2",
                    version: "VF",
                    episodes: "8",
                    platform: "generic"
                }
            ]
        };

        let currentTab = 'films';
        let filteredData = [];
        let currentVideoData = null;

        function generateMediaCard(media) {
            const hasEpisodes = media.episodes && currentTab !== 'films';
            const platformIcon = {
                'bilibili': '🅱️',
                'iqiyi': '🎯',
                'generic': '🎬'
            };
            
            return `
                <div class="short">
                    <div class="short-in nl">
                        <span class="film-version">
                            <a href="#">${media.version} ${platformIcon[media.platform] || '🎬'}</a>
                        </span>
                        <a class="short-poster img-box with-mask" href="#" onclick="playMedia('${media.title}', '${media.url}', '${media.platform}')" alt="${media.title}">
                            <div class="vote-circle" data-id="${media.id}">
                                <span class="vote-score">${media.rating}</span>
                            </div>
                            <img src="${media.poster}" width="160" height="240" alt="${media.title} affiche" onerror="this.src='https://via.placeholder.com/160x240/333/fff?text=Affiche'" />
                            <div class="short-mask fx-col fx-center fx-middle">
                                <span class="fa fa-play-circle3"></span>
                            </div>
                        </a>
                        ${hasEpisodes ? `<span class="mli-eps">${media.episodes} <i></i></span>` : ''}
                        <div class="short-title">${media.title}</div>
                    </div>
                </div>
            `;
        }

        function switchTab(tab) {
            currentTab = tab;
            
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            renderContent();
        }

        function renderContent() {
            const grid = document.getElementById('contentGrid');
            const data = filteredData.length > 0 ? filteredData : mediaData[currentTab];
            
            grid.innerHTML = data.map(media => generateMediaCard(media)).join('');
        }

        function searchContent() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            
            if (query.trim() === '') {
                filteredData = [];
            } else {
                filteredData = mediaData[currentTab].filter(media => 
                    media.title.toLowerCase().includes(query) ||
                    media.genre.toLowerCase().includes(query) ||
                    media.description.toLowerCase().includes(query)
                );
            }
            
            renderContent();
        }

        async function playMedia(title, url, platform) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('playerModal').classList.add('active');
            document.getElementById('loadingOverlay').style.display = 'flex';
            document.getElementById('videoPlayer').style.display = 'none';
            
            try {
                // Analyser l'URL avec l'API simulée
                currentVideoData = await VideoParser.parseUrl(url);
                
                // Masquer le loading
                document.getElementById('loadingOverlay').style.display = 'none';
                
                // Configurer les sélecteurs de qualité et sous-titres
                setupQualitySelector();
                setupSubtitleSelector();
                
                // Afficher le lecteur vidéo
                setupVideoPlayer();
                
                // Afficher le statut
                const statusIndicator = document.getElementById('statusIndicator');
                statusIndicator.textContent = `${currentVideoData.videoType.toUpperCase()} - ${platform}`;
                statusIndicator.style.display = 'block';
                
            } catch (error) {
                console.error('Erreur lors de l\'analyse de la vidéo:', error);
                document.getElementById('loadingOverlay').innerHTML = `
                    <p style="color: #ff4444;">❌ Erreur lors de l'analyse de la vidéo</p>
                    <p style="font-size: 0.9rem; opacity: 0.7;">Veuillez réessayer plus tard</p>
                `;
            }
        }

        function setupQualitySelector() {
            const qualitySelector = document.getElementById('qualitySelector');
            qualitySelector.innerHTML = '<option value="">Qualité</option>';
            
            if (currentVideoData.videoUrls.length > 1) {
                currentVideoData.videoUrls.forEach((url, index) => {
                    const quality = ['720p', '1080p', '480p'][index] || `Qualité ${index + 1}`;
                    qualitySelector.innerHTML += `<option value="${index}">${quality}</option>`;
                });
                qualitySelector.onchange = () => switchQuality(qualitySelector.value);
            }
        }

        function setupSubtitleSelector() {
            const subtitleSelector = document.getElementById('subtitleSelector');
            subtitleSelector.innerHTML = '<option value="">Sous-titres</option>';
            
            if (currentVideoData.subtitles.length > 0) {
                currentVideoData.subtitles.forEach((subtitle, index) => {
                    subtitleSelector.innerHTML += `<option value="${index}">${subtitle[0]}</option>`;
                });
                subtitleSelector.onchange = () => switchSubtitle(subtitleSelector.value);
            }
        }

        function setupVideoPlayer() {
            const videoPlayer = document.getElementById('videoPlayer');
            
            // Pour la démo, on utilise une vidéo d'exemple
            // En production, on utiliserait les URLs analysées
            const demoVideoUrl = 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4';
            
            videoPlayer.src = demoVideoUrl;
            videoPlayer.style.display = 'block';
            
            // Simuler le chargement des différents formats selon le type
            console.log('Type de vidéo:', currentVideoData.videoType);
            console.log('URLs vidéo:', currentVideoData.videoUrls);
            console.log('URLs audio:', currentVideoData.audioUrls);
            console.log('Sous-titres:', currentVideoData.subtitles);
        }

        function switchQuality(qualityIndex) {
            if (qualityIndex === '') return;
            
            console.log('Changement de qualité vers:', currentVideoData.videoUrls[qualityIndex]);
            // Ici on changerait la source vidéo
        }

        function switchSubtitle(subtitleIndex) {
            if (subtitleIndex === '') return;
            
            const subtitle = currentVideoData.subtitles[subtitleIndex];
            console.log('Changement de sous-titres vers:', subtitle[0], subtitle[1]);
            // Ici on chargerait les sous-titres
        }

        function closePlayer() {
            document.getElementById('playerModal').classList.remove('active');
            document.getElementById('videoPlayer').src = '';
            document.getElementById('statusIndicator').style.display = 'none';
            currentVideoData = null;
        }

        // Fermer le modal en cliquant à l'extérieur
        document.getElementById('playerModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePlayer();
            }
        });

        // Recherche en temps réel
        document.getElementById('searchInput').addEventListener('input', searchContent);

        // Initialiser le contenu
        renderContent();
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XalaFlix - Films et Séries en Streaming</title>
    <style>
        /* [Tous les styles CSS précédents restent identiques] */
        /* ... */
    </style>
</head>
<body>
    <!-- Suppression de l'overlay anti-adblock -->
    
    <header class="header">
        <!-- [Le reste du header reste identique] -->
        <!-- ... -->
    </header>

    <!-- [Toutes les autres sections HTML restent identiques] -->
    <!-- ... -->

    <script>
        // Configuration des serveurs de streaming
        const streamingServers = {
            server1: "https://vidsrc.to/embed/movie/",
            server2: "https://vidsrc.me/embed/movie/",
            server3: "https://2embed.org/embed/movie/",
            server4: "https://www.2embed.ru/embed/imdb/movie/",
            seriesServer1: "https://vidsrc.to/embed/tv/",
            seriesServer2: "https://vidsrc.me/embed/tv/",
            seriesServer3: "https://2embed.org/embed/tv/"
        };

        // [La base de données de contenu reste identique]
        // ...

        let currentFilter = 'all';
        let allContent = [...contentDatabase];
        let currentContent = null;
        let currentServer = null;
        let currentSeason = 1;
        let currentEpisode = 1;
        let adblockDetected = false;

        // Nouvelle fonction pour nettoyer les iframes des publicités
        function cleanVideoFrame(frame) {
            try {
                // Suppression des éléments publicitaires courants
                const adSelectors = [
                    '.ad-container', '.advertisement', '[class*="ad-"]',
                    '[id*="ad-"]', '.video-ad', '.ad-unit'
                ];
                
                adSelectors.forEach(selector => {
                    const ads = frame.contentDocument.querySelectorAll(selector);
                    ads.forEach(ad => ad.remove());
                });

                // Désactivation des scripts publicitaires
                const scripts = frame.contentDocument.querySelectorAll('script');
                scripts.forEach(script => {
                    if (script.src.includes('ads') || 
                        script.textContent.includes('advertisement') ||
                        script.textContent.includes('advertise') ||
                        script.textContent.includes('google_ad')) {
                        script.remove();
                    }
                });

                // Blocage des requêtes publicitaires
                const originalFetch = window.fetch;
                window.fetch = function(url, options) {
                    if (url && typeof url === 'string' && 
                        (url.includes('ads') || url.includes('adserver') || 
                         url.includes('doubleclick') || url.includes('pubmatic'))) {
                        return Promise.reject(new Error('Blocked by ad cleaner'));
                    }
                    return originalFetch(url, options);
                };

                console.log('Nettoyage des publicités effectué');
            } catch (e) {
                console.log('Nettoyage des publicités partiel (limitations CORS)');
            }
        }

        // Modification de la fonction openPlayerModal
        function openPlayerModal(internalId, title, type) {
            currentContent = contentDatabase.find(item => item.internalId === internalId);
            if (!currentContent) return;

            document.getElementById('modalTitle').textContent = title;
            document.getElementById('videoModal').style.display = 'block';
            document.body.style.overflow = 'hidden';

            // Configuration de la sidebar pour les séries
            const sidebar = document.getElementById('playerSidebar');
            if (type === 'series') {
                sidebar.style.display = 'block';
                setupSeriesPlayer();
            } else {
                sidebar.style.display = 'none';
                setupMoviePlayer();
            }

            // Configuration des serveurs
            setupServerButtons();
        }

        // Modification de la fonction loadDirectVideo
        function loadDirectVideo(url) {
            showLoading();
            
            const videoFrame = document.getElementById('videoFrame');
            
            videoFrame.onload = function() {
                // Appliquer le nettoyage des pubs après le chargement
                try {
                    cleanVideoFrame(videoFrame);
                } catch (e) {
                    console.log('Nettoyage des pubs impossible (CORS): ', e);
                }
                hideLoading();
            };

            videoFrame.onerror = function() {
                hideLoading();
                alert('Erreur de chargement du contenu.');
            };

            videoFrame.src = url;
        }

        // Modification de loadMovieVideo et loadSeriesVideo
        function loadMovieVideo() {
            showLoading();
            
            const videoFrame = document.getElementById('videoFrame');
            const serverUrl = streamingServers[currentServer];
            
            let videoUrl = '';
            if (currentContent.imdbId) {
                videoUrl = `${serverUrl}${currentContent.imdbId}`;
            } else if (currentContent.tmdbId) {
                videoUrl = `${serverUrl}${currentContent.tmdbId}`;
            } else {
                videoUrl = `${serverUrl}${currentContent.internalId}`;
            }
            
            videoFrame.onload = function() {
                try {
                    cleanVideoFrame(videoFrame);
                } catch (e) {
                    console.log('Nettoyage des pubs impossible (CORS): ', e);
                }
                hideLoading();
            };

            videoFrame.onerror = function() {
                hideLoading();
                alert('Erreur de chargement du contenu. Essayez un autre serveur.');
            };

            videoFrame.src = videoUrl;
        }

        function loadSeriesVideo(season, episode) {
            showLoading();
            
            const videoFrame = document.getElementById('videoFrame');
            const serverUrl = streamingServers[currentServer];
            
            let videoUrl = '';
            if (currentContent.imdbId) {
                videoUrl = `${serverUrl}${currentContent.imdbId}/${season}/${episode}`;
            } else if (currentContent.tmdbId) {
                videoUrl = `${serverUrl}${currentContent.tmdbId}/${season}/${episode}`;
            } else {
                videoUrl = `${serverUrl}${currentContent.internalId}/${season}/${episode}`;
            }
            
            videoFrame.onload = function() {
                try {
                    cleanVideoFrame(videoFrame);
                } catch (e) {
                    console.log('Nettoyage des pubs impossible (CORS): ', e);
                }
                hideLoading();
            };

            videoFrame.onerror = function() {
                hideLoading();
                alert('Erreur de chargement du contenu. Essayez un autre serveur.');
            };

            videoFrame.src = videoUrl;
        }

        // [Les autres fonctions restent identiques]
        // ...

        // Initialisation simplifiée sans vérification Adblock
        window.onload = function() {
            renderContent(allContent);
            
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchContent();
                }
            });
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeModal();
                }
            });
        };
    </script>
</body>
</html>